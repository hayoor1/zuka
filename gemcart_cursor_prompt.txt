# Build Brief (Read First)
You are the **Cursor Agent** using **GPT‑5**. Act as a Staff+ full‑stack engineer and product-minded architect. Your task is to **scaffold and implement an MVP** for a Nigeria‑first, highly gamified e‑commerce platform that initially sells our own apparel, then scales to a marketplace that onboards Instagram‑native brands. The app must feel **fun, modern, and viral**: coupons, simple in‑app games, ranks (gem‑style star levels), and **AI “pet” shopping assistants** with distinct personalities (grumpy, rude, nonchalant, funny) that chat as users browse.

Deliver working code that runs **locally** and can deploy easily. Default to **strong DX**, type safety, and test coverage. Prefer **simple, reliable** solutions over over‑engineering.

---

## Product Pillars
1) **Nigeria‑first commerce**
   - Start as D2C (our brand’s clothes). Then allow partner brands to onboard.
   - Accept local payments (Paystack + Flutterwave), support NGN out of the gate.
   - Shipping integrations for Nigeria (start with mock + simple aggregator, e.g. Shipbubble/Sendbox; keep provider behind a clean interface).

2) **Growth via Play & Perks**
   - **Coupons** everywhere (onboarding, referrals, streaks, post‑game rewards, spin‑the‑wheel, cart milestones).
   - **Mini‑games** (Tetris/Snake‑like) to earn coins/coupons with anti‑abuse caps.
   - **Ranks** → gem‑style star levels. Shareable social cards and OG images.

3) **AI Pets (shopping buddies)**
   - Persona‑driven assistants with swappable “attitudes” and lightweight memory of user preferences (sizes, colors, budget).
   - Inline chat that can recommend products, apply coupons (preview), and nudge checkout.

4) **Modern UX**
   - PWA (installable), buttery navigation, optimistic updates, fast search, delightful micro‑interactions.
   - Accessible, mobile‑first, dark mode.

---

## Technical Stack (lock these choices in code)
**Runtime & Framework**
- **Next.js 15.4** (App Router, RSC, Server Actions, Route Handlers) + **React 19**.
- **TypeScript** strict mode, **pnpm** workspace monorepo.
- **Node.js 22 LTS** (local + CI).

**UI/Styling**
- **Tailwind CSS v4**.
- **shadcn/ui** components + **lucide-react** icons.
- Motion via **Framer Motion**.

**Data**
- **PostgreSQL** with **Drizzle ORM** (+ drizzle-kit). Enable **pgvector** for AI memory/recommendations.
- **Redis** (leaderboards, sessions, rate limits).
- **Zod** for schemas, validation.

**Auth & Identity**
- **Auth.js** (NextAuth) with email/password + OAuth + Phone/OTP (Termii).

**Payments (Nigeria)**
- **Paystack** (default) + **Flutterwave** (feature flag) behind unified service.

**Email & Notifications**
- **Resend + React Email**.
- Push notifications (OneSignal/web push).

**Realtime**
- **Pusher/Ably** for games, leaderboards, pet chat indicators.

**Background jobs**
- **Inngest** (or cron workers for local dev).

**Search**
- **Meilisearch** (local, Dockerized).

**AI Pets**
- **OpenAI Responses API / Realtime API** with tool calls: product search, apply coupon, add to cart, estimate delivery, switch persona.

**Analytics & Experiments**
- **PostHog** for funnels, feature flags, and experiments.

**Infra & DevEx**
- Vercel deploy config, `.env.example`, linting, prettier, Vitest, Playwright, Husky hooks.
- PWA manifest + service worker.

---

## Monorepo Layout
```
apps/
  web/                # Next.js app (shopfront + admin)
  workers/            # background jobs
  games/              # React Canvas mini‑games
packages/
  ui/                 # shadcn components + tokens
  db/                 # drizzle schema + migrations
  core/               # types, utils, constants
  payments/           # Paystack/Flutterwave unified service
  ai/                 # AI pet orchestrator, prompts, tools
  realtime/           # realtime wrappers
  analytics/          # PostHog client wrappers
```

---

## Features to Implement (MVP)
1. **Catalog**: product list, filters, PDP, add to cart.
2. **Checkout**: address form, payment with Paystack, webhooks, order creation, email receipt.
3. **Coupons & Rewards**: welcome gift, daily streak, spin‑the‑wheel, referral.
4. **Games**: Snake + Tetris React Canvas, score persistence, coupon issuance, leaderboards.
5. **Ranks (Gem Levels)**: XP system, progress bar, badge icons, shareable social cards.
6. **AI Pets**: animated avatars + chat, persona switching, tool calls.
7. **Admin basics**: CRUD products, coupons, dashboard tiles.

---

## AI Pets Orchestration
- Toolset: `searchProducts`, `applyCouponPreview`, `addToCart`, `estimateShipping`, `switchPersona`.
- Personas: grumpy, rude, nonchalant, funny. Each with custom prompt tone.
- Chat: docked avatar with bubble overlay; animated pop‑ups for messages.
- Memory: per‑user preferences + recent chat; extend with pgvector later.

---

## Ranks & Gems
- XP sources: shopping, games, referrals, streaks.
- Levels: Quartz → Sapphire → Ruby → Emerald → Diamond → Obsidian → Crown.
- Shareable badges (OG images, social cards).
- Unlock perks at higher gems: free delivery, exclusive coupons, drops.

---

## Anti‑Abuse (Games & Coupons)
- Daily coin cap, cooldowns, minimum gameplay length.
- Server verifies plausible scores.
- Coupons tied to min purchase amounts.

---

## Security & Compliance
- Secure webhooks. Secrets via env. Rate limits on rewards endpoints.
- Comply with **Nigeria Data Protection Act (NDPA)**: deletion endpoint, consent flags.

---

## Acceptance Criteria
- Local dev: `pnpm i && pnpm dev` → app at localhost:3000.
- Can shop products, apply coupon, complete test Paystack payment.
- Games playable, scores saved, coupons issued under caps.
- Ranks progress works; shareable gem badge generated.
- AI pet assists with chat, persona switch works.
- Tests + linting pass; deployable on Vercel.

---

## Stretch Goals
- Vendor onboarding + payouts.
- Instagram Graph API sync for vendor catalogs.
- Native app wrapper via Expo.
- Advanced AI recs with embeddings.

---

## Name
Working name: **GemCart**. Gem‑themed levels and pets. Copy playful, localised to Nigerian audience.
